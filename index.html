<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í´ë˜ìŠ¤ì–´ë¼ìš´ë“œ Â· ìš´ì˜ë´‡ ëŒ€ì‹œë³´ë“œ</title>
  <style>
    :root{
      --bg:#020617;
      --card:#020617;
      --surface:#020617;
      --line:#1f2937;
      --text:#e5e7eb;
      --muted:#6b7280;
      --accent:#38bdf8;
      --accent-soft:#0f172a;
      --accent-strong:#0ea5e9;
      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --radius:14px;
      --gap:14px;
      --ctl-h:42px;
      --shadow-soft:0 18px 40px rgba(15,23,42,.7);
      --shadow-card:0 14px 30px rgba(15,23,42,.85);
      --border-strong:1px solid rgba(148,163,184,.6);
      --border-soft:1px solid rgba(30,64,175,0.8);
      --tab-pill-radius:999px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
      background:radial-gradient(circle at top left,#0f172a 0,#020617 50%,#000 100%);
      color:var(--text);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    .app-shell{
      max-width:1180px;
      width:100%;
      margin:20px auto 32px;
      padding:0 16px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:20px;
      gap:12px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand-logo{
      width:40px;
      height:40px;
      border-radius:16px;
      background:radial-gradient(circle at 25% 25%,#38bdf8 0,#0ea5e9 35%,#0f172a 80%);
      box-shadow:0 10px 30px rgba(56,189,248,.6);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }
    .brand-logo::before{
      content:"";
      position:absolute;
      width:22px;
      height:22px;
      border-radius:50%;
      border:3px solid rgba(15,23,42,.9);
      box-shadow:0 0 0 3px rgba(15,23,42,.7);
    }
    .brand-logo::after{
      content:"CA";
      font-size:10px;
      font-weight:700;
      color:#e5f6ff;
      letter-spacing:.04em;
    }
    .brand-text-title{
      font-size:20px;
      font-weight:700;
      letter-spacing:.03em;
    }
    .brand-text-sub{
      font-size:11px;
      color:var(--muted);
    }
    .tab-group{
      display:flex;
      align-items:center;
      gap:6px;
      background:rgba(15,23,42,.9);
      border-radius:999px;
      padding:4px;
      border:1px solid rgba(51,65,85,.8);
      box-shadow:0 14px 35px rgba(15,23,42,.8);
    }
    .tab-button{
      border:none;
      outline:none;
      background:transparent;
      color:var(--muted);
      font-size:11px;
      padding:6px 12px;
      border-radius:999px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:4px;
      transition:all .16s ease-out;
      white-space:nowrap;
    }
    .tab-button span.icon{
      font-size:13px;
    }
    .tab-button.active{
      background:radial-gradient(circle at 20% 0,#38bdf8 0,#0ea5e9 40%,#1e293b 100%);
      color:#e5f6ff;
      box-shadow:0 6px 18px rgba(56,189,248,.5);
    }
    .tab-button:not(.active):hover{
      background:rgba(30,64,175,.45);
      color:#e5e7eb;
    }

    .layout{
      display:grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1.1fr);
      gap:var(--gap);
    }
    .layout-single{
      display:block;
    }

    .card{
      background:radial-gradient(circle at top left,#020617 0,#020617 58%,#020617 100%);
      border-radius:var(--radius);
      border:var(--border-soft);
      box-shadow:var(--shadow-card);
      padding:16px 16px 14px;
      position:relative;
      overflow:hidden;
    }
    .card-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
      gap:8px;
    }
    .card-title{
      font-size:13px;
      font-weight:600;
      letter-spacing:.06em;
      text-transform:uppercase;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .card-title-pill{
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      color:var(--muted);
    }
    .card-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:10px;
    }
    .pill-status{
      font-size:10px;
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(74,222,128,.8);
      color:#bbf7d0;
      background:rgba(21,128,61,.2);
    }

    .split{
      display:grid;
      grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);
      gap:var(--gap);
    }

    .log-panel{
      height:360px;
      background:radial-gradient(circle at top,#020617 0,#020617 60%,#020617 100%);
      border-radius:12px;
      border:1px solid rgba(30,64,175,.7);
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size:11px;
      overflow:hidden;
    }
    .log-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color:var(--muted);
      margin-bottom:4px;
      font-size:10px;
    }
    .log-body{
      flex:1;
      overflow:auto;
      padding-right:4px;
    }
    .log-line{
      padding:2px 0;
      border-bottom:1px dashed rgba(30,64,175,.4);
      font-family:ui-monospace,Menlo,Consolas,"SF Mono",monospace;
      word-break:break-all;
    }

    .field-group{
      display:flex;
      flex-direction:column;
      gap:6px;
      margin-bottom:10px;
    }
    .field-label{
      font-size:11px;
      color:var(--muted);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .field-label span.right{
      font-size:10px;
    }
    .input, .select, .textarea{
      background:#020617;
      border-radius:10px;
      border:1px solid rgba(30,64,175,.8);
      height:var(--ctl-h);
      color:var(--text);
      font-size:12px;
      padding:0 10px;
      outline:none;
      width:100%;
      font-family:inherit;
      transition:border .16s ease,box-shadow .16s ease,background .16s ease;
    }
    .input:focus, .select:focus, .textarea:focus{
      border-color:#38bdf8;
      box-shadow:0 0 0 1px rgba(56,189,248,.4);
      background:#020617;
    }
    .textarea{
      min-height:90px;
      padding:8px 10px;
      resize:vertical;
      line-height:1.4;
    }
    .select{
      padding-right:26px;
    }

    .row{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .row.wrap{flex-wrap:wrap;}
    .row.right{justify-content:flex-end;}
    .row.between{justify-content:space-between;}

    .btn{
      border:none;
      outline:none;
      border-radius:999px;
      font-size:11px;
      padding:0 14px;
      height:30px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      cursor:pointer;
      white-space:nowrap;
      font-weight:500;
      letter-spacing:.02em;
      transition:all .16s ease-out;
    }
    .btn-primary{
      background:linear-gradient(135deg,#38bdf8,#0ea5e9);
      color:#0b1120;
      box-shadow:0 8px 22px rgba(56,189,248,.7);
      border:1px solid rgba(125,211,252,.9);
    }
    .btn-primary:hover{filter:brightness(1.05);transform:translateY(-1px);}
    .btn-ghost{
      background:rgba(15,23,42,.9);
      color:var(--muted);
      border:1px solid rgba(51,65,85,.9);
    }
    .btn-ghost:hover{
      background:rgba(30,64,175,.7);
      color:#e5e7eb;
    }
    .btn-danger{
      background:rgba(127,29,29,.9);
      color:#fecaca;
      border:1px solid rgba(248,113,113,.8);
    }
    .btn-sm{
      height:26px;
      padding:0 10px;
      font-size:10px;
    }

    .badge{
      font-size:10px;
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.6);
      color:var(--muted);
    }

    .pill-radio-group{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .pill-radio{
      font-size:10px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(51,65,85,.9);
      color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .pill-radio.active{
      border-color:#38bdf8;
      background:rgba(56,189,248,.12);
      color:#e0f2fe;
    }

    .template-list{
      border-radius:10px;
      border:1px solid rgba(30,64,175,.7);
      padding:8px;
      max-height:220px;
      overflow:auto;
      background:radial-gradient(circle at top,#020617 0,#020617 60%,#020617 100%);
    }
    .template-item{
      border-radius:8px;
      border:1px solid rgba(30,64,175,.8);
      padding:8px;
      margin-bottom:6px;
      background:rgba(15,23,42,.9);
      font-size:11px;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .template-item:last-child{margin-bottom:0;}
    .template-title{
      font-size:11px;
      font-weight:600;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    .template-meta{
      font-size:10px;
      color:var(--muted);
    }
    .template-body{
      white-space:pre-wrap;
      word-break:break-word;
    }

    .folder-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
      gap:10px;
      margin-top:8px;
      max-height:260px;
      overflow:auto;
    }
    .folder-card{
      border-radius:12px;
      border:1px solid rgba(30,64,175,.8);
      padding:10px;
      background:radial-gradient(circle at top,#020617 0,#020617 60%,#020617 100%);
      cursor:pointer;
      position:relative;
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:11px;
    }
    .folder-card:hover{
      border-color:#38bdf8;
      box-shadow:0 10px 26px rgba(15,23,42,.8);
    }
    .folder-name{
      font-weight:600;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .folder-name span.icon{
      font-size:15px;
    }
    .folder-url{
      font-size:10px;
      color:var(--muted);
      word-break:break-all;
    }
    .folder-delete{
      position:absolute;
      top:6px;
      right:6px;
    }

    .csv-preview{
      border-radius:10px;
      border:1px solid rgba(30,64,175,.8);
      max-height:260px;
      overflow:auto;
      margin-top:8px;
      background:#020617;
    }
    .csv-preview table{
      border-collapse:collapse;
      width:100%;
      font-size:11px;
    }
    .csv-preview th, .csv-preview td{
      border:1px solid rgba(30,64,175,.6);
      padding:4px 6px;
      text-align:left;
      white-space:nowrap;
    }
    .csv-preview th{
      background:rgba(15,23,42,.9);
      position:sticky;
      top:0;
      z-index:1;
    }

    .help-text{
      font-size:10px;
      color:var(--muted);
    }

    .hidden{display:none!important;}

    @media (max-width:900px){
      header{flex-direction:column;align-items:flex-start;}
      .layout{grid-template-columns:1fr;}
      .split{grid-template-columns:1fr;}
      .tab-group{align-self:flex-end;}
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand">
        <div class="brand-logo"></div>
        <div>
          <div class="brand-text-title">í´ë˜ìŠ¤ì–´ë¼ìš´ë“œ ìš´ì˜ë´‡</div>
          <div class="brand-text-sub">ì¹´í†¡ ì…ì¥ì Â· ì±—ë´‡ ë°ì´í„° Â· ì„¸ì¼ì¦ˆ ë©˜íŠ¸ Â· ë“œë¼ì´ë¸Œ Â· ê²°ì œì CSV</div>
        </div>
      </div>
      <div class="tab-group" id="tabGroup">
        <button class="tab-button active" data-tab="tab-kakao">
          <span class="icon">ğŸ’¬</span>ì¹´í†¡ ì…ì¥ì
        </button>
        <button class="tab-button" data-tab="tab-chatbot">
          <span class="icon">ğŸ“Š</span>ì±—ë´‡ ë°ì´í„°
        </button>
        <button class="tab-button" data-tab="tab-sales">
          <span class="icon">ğŸ§ </span>ì„¸ì¼ì¦ˆ ë©˜íŠ¸ GPTs
        </button>
        <button class="tab-button" data-tab="tab-drive">
          <span class="icon">ğŸ“</span>ë“œë¼ì´ë¸Œ ë§í¬
        </button>
        <button class="tab-button" data-tab="tab-csv">
          <span class="icon">ğŸ’³</span>ê²°ì œì CSV
        </button>
      </div>
    </header>

    <!-- ========= TAB 1: ì¹´í†¡ ì…ì¥ì ========= -->
    <section id="tab-kakao" class="layout">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            ì¹´ì¹´ì˜¤í†¡ ì…ì¥ì ì²´í¬
            <span class="card-title-pill">LOG Â· STATUS</span>
          </div>
          <span class="pill-status">READY</span>
        </div>
        <div class="card-sub">
          ì™¼ìª½ì€ í”„ë¡œê·¸ë¨ ì‹¤í–‰ ë¡œê·¸ / ì˜¤ë¥¸ìª½ì€ ì„¤ì • íŒ¨ë„ë¡œ êµ¬ì„±í•œ ê¸°ë³¸ êµ¬ì¡°ì•¼.  
          ì‹¤ì œ ë¡œì»¬ ì‹¤í–‰ í”„ë¡œê·¸ë¨ê³¼ ì—°ë™ë˜ëŠ” ë¶€ë¶„(í´ë” ê°ì‹œ, ë¡œê·¸ ì…ë ¥ ë“±)ì€
          ê¸°ì¡´ ì½”ë“œì—ì„œ ì´ ì˜ì—­ì— ë§ì¶° ë¶™ì´ë©´ ëœë‹¤.
        </div>
        <div class="split">
          <div class="log-panel" id="kakaoLogPanel">
            <div class="log-header">
              <span>ì‹¤í–‰ ë¡œê·¸</span>
              <button class="btn btn-ghost btn-sm" type="button" id="btnClearKakaoLog">ë¡œê·¸ ì´ˆê¸°í™”</button>
            </div>
            <div class="log-body" id="kakaoLogBody">
              <div class="log-line">[INFO] ì¹´ì¹´ì˜¤ ì…ì¥ì ì²´í¬ ëª¨ë“ˆ ëŒ€ê¸° ì¤‘...</div>
            </div>
          </div>
          <div>
            <div class="field-group">
              <div class="field-label">
                <span>ì¹´í†¡ ëŒ€í™” í´ë” ì„ íƒ (PCí†¡ txt / csv ì €ì¥ ìœ„ì¹˜)</span>
              </div>
              <div class="row">
                <input class="input" id="kakaoFolderPath" placeholder="ì˜ˆ: C:\Users\YOU\Documents\KakaoTalk Chats" />
                <button class="btn btn-ghost btn-sm" type="button" id="btnMockFolderPick">í´ë” ì„ íƒ (ë©”ëª¨ìš©)</button>
              </div>
              <div class="help-text">
                ì›¹ì—ì„œëŠ” ì‹¤ì œ í´ë” ì ‘ê·¼ì´ ì•ˆ ë˜ë‹ˆ, ì´ ê°’ì€ <strong>ë©”ëª¨/ì„¤ì •ìš©</strong>ìœ¼ë¡œë§Œ ì €ì¥í•´ë‘”ë‹¤ê³  ìƒê°í•˜ë©´ ë¼.  
                ì‹¤ì œ í´ë” ê°ì‹œëŠ” ë¡œì»¬ í”„ë¡œê·¸ë¨ ì½”ë“œì—ì„œ ì²˜ë¦¬í•˜ê³ , ì—¬ê¸´ UI ì •ë¦¬/ê¸°ë¡ ìš©ë„.
              </div>
            </div>

            <div class="field-group">
              <div class="field-label">
                <span>ì¹´í†¡ë°© ì´ë¦„ / ID ë©”ëª¨</span>
                <span class="right help-text">ì‰¼í‘œ(,)ë¡œ ì—¬ëŸ¬ ê°œ ì…ë ¥ ê°€ëŠ¥</span>
              </div>
              <input class="input" id="kakaoRoomsInput" placeholder="ì˜ˆ: ì‹œë‹ˆì–´ì‡¼ì¸  1ë²ˆë°©, ì‹œë‹ˆì–´ì‡¼ì¸  2ë²ˆë°©" />
            </div>

            <div class="field-group">
              <div class="field-label">
                <span>ì‹¤í–‰ ì»¨íŠ¸ë¡¤</span>
              </div>
              <div class="row wrap">
                <button class="btn btn-primary" type="button" id="btnKakaoStart">
                  â–¶ ì‹¤í–‰ (ëª¨ì˜)
                </button>
                <button class="btn btn-danger" type="button" id="btnKakaoStop">
                  â¹ ì •ì§€ (ëª¨ì˜)
                </button>
                <button class="btn btn-ghost" type="button" id="btnKakaoLogSample">
                  ğŸ’¡ ìƒ˜í”Œ ë¡œê·¸ ì¶”ê°€
                </button>
              </div>
              <div class="help-text">
                ì‹¤ì§ˆì ì¸ ì‹œì‘/ì •ì§€ ë¡œì§ì€ ë¡œì»¬ ì‹¤í–‰ í”„ë¡œê·¸ë¨ ì•ˆì—ì„œ ì²˜ë¦¬í•˜ê³ ,  
                ì´ ë²„íŠ¼ë“¤ì€ ë‹¨ìˆœíˆ <strong>ìƒíƒœ í‘œì‹œ + ë¡œê·¸ ê¸°ë¡</strong> ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">
            ì¹´í†¡ ì…ì¥ì ì„¤ì • ì €ì¥
            <span class="card-title-pill">LOCAL STORAGE</span>
          </div>
        </div>
        <div class="card-sub">
          ìì£¼ ì“°ëŠ” í´ë” ê²½ë¡œ / ë°© ì •ë³´ ë“±ì„ ë¸Œë¼ìš°ì €(localStorage)ì— ì €ì¥í•´ë‘ê³   
          ìš´ì˜í•  ë•Œë§ˆë‹¤ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì„¤ì • ì˜ì—­.
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>ì„¤ì • í”„ë¡œí•„ ì´ë¦„</span>
            <span class="right help-text">ì˜ˆ: ì‹œë‹ˆì–´ì‡¼ì¸  3ê¸° ì…ì¥ì ì²´í¬</span>
          </div>
          <input class="input" id="kakaoProfileName" placeholder="í”„ë¡œí•„ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div class="row wrap">
          <button class="btn btn-primary btn-sm" type="button" id="btnKakaoSaveProfile">
            ğŸ’¾ í˜„ì¬ ì„¤ì • ì €ì¥
          </button>
          <button class="btn btn-ghost btn-sm" type="button" id="btnKakaoLoadLastProfile">
            âª ë§ˆì§€ë§‰ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
          </button>
          <span class="help-text">ë¸Œë¼ìš°ì € ë‹¨ìœ„ë¡œ ì €ì¥ë˜ë¯€ë¡œ, ê°™ì€ PC/ë¸Œë¼ìš°ì €ì—ì„œë§Œ ìœ ì§€ë¨.</span>
        </div>
      </div>
    </section>

    <!-- ========= TAB 2: ì±—ë´‡ ë°ì´í„° ========= -->
    <section id="tab-chatbot" class="layout-single hidden">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            ë©”ì‹ ì €ë´‡R Â· ì±—ë´‡ ë°ì´í„° íŒ¨ë„
            <span class="card-title-pill">OVERVIEW</span>
          </div>
        </div>
        <div class="card-sub">
          ë©”ì‹ ì €ë´‡R DB í˜ì´ì§€, í†µê³„ ì‹œíŠ¸, ë¡œê·¸ ì‹œíŠ¸ ë“± <strong>ì±—ë´‡ ê´€ë ¨ ë§í¬ë¥¼ í•œ ê³³ì— ëª¨ì•„ë‘ëŠ” í—ˆë¸Œ</strong>ì•¼.  
          ì•„ë˜ì— ë§í¬ë¥¼ ì¶”ê°€í•´ë‘ê³ , í•„ìš”í•œ í˜ì´ì§€ë¥¼ ë°”ë¡œ ì—´ ìˆ˜ ìˆì–´.
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>ì±—ë´‡ ê´€ë ¨ ë§í¬ ì¶”ê°€</span>
            <span class="right help-text">ì˜ˆ: ë©”ì‹ ì €ë´‡R DB ëŒ€ì‹œë³´ë“œ, ëª…ë ¹ì–´ ì •ì˜ ì‹œíŠ¸ ë“±</span>
          </div>
          <input class="input" id="chatbotLinkName" placeholder="ì´ë¦„ (ì˜ˆ: ë©”ì‹ ì €ë´‡R DB ëŒ€ì‹œë³´ë“œ)" />
          <input class="input" id="chatbotLinkUrl" placeholder="URL (https:// ë¡œ ì‹œì‘)" />
          <div class="row wrap">
            <button class="btn btn-primary btn-sm" type="button" id="btnChatbotAddLink">â• ë§í¬ ì¶”ê°€</button>
            <span class="help-text">ë¸Œë¼ìš°ì €(localStorage)ì—ë§Œ ì €ì¥ë˜ë¯€ë¡œ, ê³µìš©PCì—ì„œëŠ” ì‚¬ìš© ì‹œ ì£¼ì˜.</span>
          </div>
        </div>

        <div class="template-list" id="chatbotLinkList">
          <!-- ë™ì  ì±„ì›€ -->
        </div>
      </div>
    </section>

    <!-- ========= TAB 3: ì„¸ì¼ì¦ˆ ë©˜íŠ¸ GPTs ========= -->
    <section id="tab-sales" class="layout-single hidden">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            ì„¸ì¼ì¦ˆ ë©˜íŠ¸ ìƒì„± Â· ì €ì¥
            <span class="card-title-pill">GPTs API</span>
          </div>
          <span class="badge">OpenAI API ì‚¬ìš© (ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í˜¸ì¶œ)</span>
        </div>
        <div class="card-sub">
          <strong>API í‚¤ë¥¼ ì§ì ‘ ì…ë ¥</strong>í•´ì„œ, ì‹œë‹ˆì–´ì‡¼ì¸  / ì‡¼í•‘ì‡¼ì¸  / ê°ì¢… ê°•ì˜ìš© <strong>ì„¸ì¼ì¦ˆ ë©˜íŠ¸</strong>ë¥¼  
          ìƒì„±í•˜ê³ , ë°”ë¡œ ì•„ë˜ ë¦¬ìŠ¤íŠ¸ì— í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•´ë‘ëŠ” êµ¬ì¡°ì•¼.
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>OpenAI API Key</span>
            <span class="right help-text">ê³µìš©PCì—ì„œëŠ” ì…ë ¥í•˜ì§€ ë§ ê²ƒ</span>
          </div>
          <div class="row">
            <input class="input" id="openaiApiKey" type="password" placeholder="sk-ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ë¥¼ ì…ë ¥" />
            <button class="btn btn-ghost btn-sm" type="button" id="btnToggleApiKey">ë³´ê¸°</button>
          </div>
          <div class="help-text">
            í‚¤ëŠ” ë¸Œë¼ìš°ì € localStorageì— <strong>ì„ íƒì ìœ¼ë¡œ</strong> ì €ì¥í•  ìˆ˜ ìˆê²Œ í•´ë‘˜ê¹Œ í–ˆì§€ë§Œ,  
            ì•ˆì „ì„ ìœ„í•´ <strong>ê¸°ë³¸ì€ ì„¸ì…˜(ë¦¬ë¡œë“œ ì‹œ ì‚¬ë¼ì§)</strong>ìœ¼ë¡œë§Œ ì‚¬ìš©í•˜ë„ë¡ ì„¤ê³„í•´ë†¨ì–´.
          </div>
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>ê¸°ë³¸ í”„ë¡¬í”„íŠ¸(ì‹œìŠ¤í…œ ë©”ì‹œì§€)</span>
            <span class="right help-text">ë„ˆê°€ ì´ë¯¸ êµ¬ì¶•í•œ ì„¸ì¼ì¦ˆ í…œí”Œë¦¿ ìš”ì•½ë³¸ì„ ë„£ì–´ë„ ë¨</span>
          </div>
          <textarea class="textarea" id="salesSystemPrompt" placeholder="ì˜ˆ: ë‹¹ì‹ ì€ í´ë˜ìŠ¤ì–´ë¼ìš´ë“œ ì„¸ì¼ì¦ˆ ë©˜íŠ¸ ì „ë¬¸ê°€ì…ë‹ˆë‹¤..."></textarea>
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>ìš”ì²­ ë‚´ìš© (ì´ë²ˆì— ë§Œë“¤ ë©˜íŠ¸ ìƒí™© ì„¤ëª…)</span>
            <span class="right help-text">íƒ€ê¹ƒ / ë¬´ë£Œ or ë³¸ê°• / í›„í‚¹ í¬ì¸íŠ¸ ë“±</span>
          </div>
          <textarea class="textarea" id="salesUserPrompt" placeholder="ì˜ˆ) 40~50ëŒ€ ì›Œí‚¹ë§˜ ëŒ€ìƒ, ì‹œë‹ˆì–´ì‡¼ì¸  ë¬´ë£Œê°•ì˜ ì…ì¥ ìœ ë„ ë©˜íŠ¸ 5ê°œ..."></textarea>
        </div>

        <div class="row wrap">
          <button class="btn btn-primary" type="button" id="btnGenerateSales">
            ğŸ§  ì„¸ì¼ì¦ˆ ë©˜íŠ¸ ìƒì„±
          </button>
          <span class="help-text" id="salesStatusText">ëŒ€ê¸° ì¤‘...</span>
        </div>

        <div class="field-group" style="margin-top:12px;">
          <div class="field-label">
            <span>ìƒì„± ê²°ê³¼</span>
          </div>
          <textarea class="textarea" id="salesResult" placeholder="ì—¬ê¸°ì— GPT ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤." readonly></textarea>
        </div>

        <div class="row wrap">
          <input class="input" id="salesTemplateTitle" placeholder="ì´ ê²°ê³¼ë¥¼ ì €ì¥í•  ì´ë¦„ (ì˜ˆ: 4050 ì‹œë‹ˆì–´ì‡¼ì¸  ë¬´ë£Œê°•ì˜ ì˜¤í”„ë‹)" />
          <button class="btn btn-primary btn-sm" type="button" id="btnSaveSalesTemplate">ğŸ’¾ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥</button>
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>ì €ì¥ëœ ì„¸ì¼ì¦ˆ ë©˜íŠ¸ í…œí”Œë¦¿</span>
          </div>
          <div class="template-list" id="salesTemplateList">
            <!-- ì„¸ì¼ì¦ˆ í…œí”Œë¦¿ ì €ì¥ ë¦¬ìŠ¤íŠ¸ -->
          </div>
        </div>
      </div>
    </section>

    <!-- ========= TAB 4: ë“œë¼ì´ë¸Œ í´ë” ë§í¬ ========= -->
    <section id="tab-drive" class="layout-single hidden">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            Google Drive í´ë” ë§í¬ ëª¨ìŒ
            <span class="card-title-pill">FOLDER SHORTCUTS</span>
          </div>
        </div>
        <div class="card-sub">
          ìì£¼ ì‚¬ìš©í•˜ëŠ” <strong>ê³µìœ  ë“œë¼ì´ë¸Œ / ê°•ì˜ë³„ ìë£Œ í´ë” / ë””ìì¸ ì—ì…‹ í´ë”</strong> ë§í¬ë¥¼  
          í•œ ë²ˆì— ê´€ë¦¬í•˜ëŠ” ê³µê°„ì´ì•¼.  
          ì…ë ¥ â†’ ì €ì¥í•˜ë©´ <strong>í´ë” ì•„ì´ì½˜ ì¹´ë“œ</strong>ë¡œ ë‚˜íƒ€ë‚˜ê³ , í´ë¦­ ì‹œ ìƒˆ íƒ­ìœ¼ë¡œ ë°”ë¡œ ì´ë™.
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>í´ë” ì´ë¦„</span>
            <span class="right help-text">ì˜ˆ: ì‹œë‹ˆì–´ì‡¼ì¸  ì¸ë„¤ì¼ ì›ë³¸ í´ë”</span>
          </div>
          <input class="input" id="driveFolderName" placeholder="í´ë” ì´ë¦„" />
        </div>
        <div class="field-group">
          <div class="field-label">
            <span>í´ë” ë§í¬(URL)</span>
            <span class="right help-text">Google Drive ê³µìœ  URL ê·¸ëŒ€ë¡œ ë³µë¶™</span>
          </div>
          <input class="input" id="driveFolderUrl" placeholder="https://drive.google.com/..." />
        </div>
        <div class="row wrap">
          <button class="btn btn-primary btn-sm" type="button" id="btnAddDriveFolder">
            ğŸ“ í´ë” ì¶”ê°€
          </button>
          <button class="btn btn-ghost btn-sm" type="button" id="btnClearDriveFolders">
            ğŸ—‘ ì „ì²´ ì‚­ì œ
          </button>
          <span class="help-text">ë¸Œë¼ìš°ì € localStorageì— ì €ì¥. ë…¸íŠ¸ë¶/ë¸Œë¼ìš°ì € ë°”ë€Œë©´ ë‹¤ì‹œ ë“±ë¡ í•„ìš”.</span>
        </div>

        <div class="folder-grid" id="driveFolderGrid">
          <!-- ë™ì  í´ë” ì¹´ë“œ -->
        </div>
      </div>
    </section>

    <!-- ========= TAB 5: ê²°ì œì CSV ì •ë¦¬ ========= -->
    <section id="tab-csv" class="layout-single hidden">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            ê²°ì œì CSV â†’ ì •ë¦¬ Â· ì—…ë¡œë“œ
            <span class="card-title-pill">CSV PIPELINE</span>
          </div>
        </div>
        <div class="card-sub">
          ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë‹¤ìš´ë°›ì€ <strong>ê²°ì œ ë‚´ì—­ CSV</strong>ë¥¼ ì—…ë¡œë“œí•´ì„œ  
          ë¸Œë¼ìš°ì €ì—ì„œ ë¨¼ì € êµ¬ì¡°ë¥¼ í™•ì¸í•˜ê³ ,  
          í•„ìš”í•˜ë©´ ì •ë¦¬ë³¸ì„ ë‹¤ì‹œ CSVë¡œ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜, Apps Script ì›¹ì•±ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” êµ¬ê°„ì´ì•¼.
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>CSV íŒŒì¼ ì—…ë¡œë“œ</span>
            <span class="right help-text">UTF-8 CSV ê¶Œì¥</span>
          </div>
          <input class="input" id="csvFileInput" type="file" accept=".csv,text/csv" />
        </div>

        <div class="field-group">
          <div class="field-label">
            <span>Apps Script WebApp URL (ì„ íƒ)</span>
            <span class="right help-text">ì‹œíŠ¸ì— ë°”ë¡œ ë„£ê³  ì‹¶ì„ ë•Œë§Œ ì‚¬ìš©</span>
          </div>
          <input class="input" id="csvWebAppUrl" placeholder="https://script.google.com/macros/s/..." />
          <div class="help-text">
            ì—¬ê¸°ì— URLì„ ë„£ê³  <strong>â€œì‹œíŠ¸ë¡œ ì „ì†¡â€</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´,  
            í˜„ì¬ íŒŒì‹±ëœ CSV ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë³´ë‚´ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆì–´.  
            ì‹¤ì œ ì²˜ë¦¬ ë¡œì§ì€ Apps Scriptì—ì„œ ë°›ëŠ” í˜•ì‹ì— ë§ê²Œ êµ¬í˜„í•´ì£¼ë©´ ëœë‹¤.
          </div>
        </div>

        <div class="row wrap">
          <button class="btn btn-primary btn-sm" type="button" id="btnDownloadCsvClean">
            ğŸ’¾ ì •ë¦¬ë³¸ CSV ë‹¤ìš´ë¡œë“œ
          </button>
          <button class="btn btn-ghost btn-sm" type="button" id="btnSendCsvToWebApp">
            ğŸ“¤ ì‹œíŠ¸ë¡œ ì „ì†¡ (WebApp)
          </button>
          <span class="help-text" id="csvStatusText">CSV ë¯¸ë¡œë”©</span>
        </div>

        <div class="csv-preview" id="csvPreviewContainer" style="display:none;">
          <table id="csvPreviewTable"></table>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ========= ê³µí†µ íƒ­ ì „í™˜ =========
    const tabButtons = document.querySelectorAll(".tab-button");
    const tabs = document.querySelectorAll("section[id^='tab-']");

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.tab;
        tabButtons.forEach(b => b.classList.toggle("active", b === btn));
        tabs.forEach(tab => {
          tab.classList.toggle("hidden", tab.id !== target);
        });
      });
    });

    // ========= ê°„ë‹¨ ë¡œê¹… ìœ í‹¸ =========
    function appendLog(containerId, message){
      const body = document.getElementById(containerId);
      if(!body) return;
      const line = document.createElement("div");
      line.className = "log-line";
      const now = new Date();
      const hh = String(now.getHours()).padStart(2,"0");
      const mm = String(now.getMinutes()).padStart(2,"0");
      const ss = String(now.getSeconds()).padStart(2,"0");
      line.textContent = `[${hh}:${mm}:${ss}] ${message}`;
      body.appendChild(line);
      body.scrollTop = body.scrollHeight;
    }

    // ========= TAB1: ì¹´í†¡ ì…ì¥ì =========
    (function initKakao(){
      const logBody = document.getElementById("kakaoLogBody");
      const btnClearLog = document.getElementById("btnClearKakaoLog");
      const btnStart = document.getElementById("btnKakaoStart");
      const btnStop = document.getElementById("btnKakaoStop");
      const btnSample = document.getElementById("btnKakaoLogSample");
      const btnMockFolder = document.getElementById("btnMockFolderPick");
      const folderInput = document.getElementById("kakaoFolderPath");
      const roomsInput = document.getElementById("kakaoRoomsInput");
      const profileNameInput = document.getElementById("kakaoProfileName");
      const btnSaveProfile = document.getElementById("btnKakaoSaveProfile");
      const btnLoadLast = document.getElementById("btnKakaoLoadLastProfile");

      btnClearLog.addEventListener("click", () => {
        logBody.innerHTML = "";
        appendLog("kakaoLogBody","ë¡œê·¸ë¥¼ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
      });

      btnStart.addEventListener("click", () => {
        appendLog("kakaoLogBody","ì¹´í†¡ ì…ì¥ì ì²´í¬ ëª¨ë“ˆ ì‹¤í–‰ (UI ìƒ ëª¨ì˜ ë™ì‘).");
      });

      btnStop.addEventListener("click", () => {
        appendLog("kakaoLogBody","ì¹´í†¡ ì…ì¥ì ì²´í¬ ëª¨ë“ˆ ì •ì§€ (UI ìƒ ëª¨ì˜ ë™ì‘).");
      });

      btnSample.addEventListener("click", () => {
        appendLog("kakaoLogBody","[DEBUG] ë°© 'ì‹œë‹ˆì–´ì‡¼ì¸  1ë²ˆë°©' ì‹ ê·œ ì…ì¥ì 3ëª… ê°ì§€ (ì˜ˆì‹œ).");
      });

      btnMockFolder.addEventListener("click", () => {
        appendLog("kakaoLogBody","í´ë” ì„ íƒì€ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€. ì´ ì…ë ¥ì°½ì€ ë©”ëª¨ìš© ê²½ë¡œ í•„ë“œì…ë‹ˆë‹¤.");
      });

      const STORAGE_KEY = "ca_kakao_profile_last";
      btnSaveProfile.addEventListener("click", () => {
        const name = profileNameInput.value.trim() || "ê¸°ë³¸ í”„ë¡œí•„";
        const data = {
          name,
          folderPath: folderInput.value,
          rooms: roomsInput.value,
          savedAt: new Date().toISOString()
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        appendLog("kakaoLogBody",`ì„¤ì • í”„ë¡œí•„ '${name}' ì €ì¥ ì™„ë£Œ.`);
      });

      btnLoadLast.addEventListener("click", () => {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          appendLog("kakaoLogBody","ì €ì¥ëœ ì„¤ì • í”„ë¡œí•„ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }
        try{
          const data = JSON.parse(raw);
          profileNameInput.value = data.name || "";
          folderInput.value = data.folderPath || "";
          roomsInput.value = data.rooms || "";
          appendLog("kakaoLogBody",`ì„¤ì • í”„ë¡œí•„ '${data.name || "ì´ë¦„ ì—†ìŒ"}' ë¶ˆëŸ¬ì˜´.`);
        }catch(e){
          appendLog("kakaoLogBody","ì„¤ì • í”„ë¡œí•„ íŒŒì‹± ì˜¤ë¥˜. localStorageë¥¼ í•œë²ˆ ì§€ìš°ëŠ” ê²ƒì„ ê¶Œì¥.");
        }
      });

      // ì´ˆê¸° ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ í”„ë¡œí•„ ìë™ ë°˜ì˜ì€ ì„ íƒì . í•„ìš”í•˜ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ.
      // btnLoadLast.click();
    })();

    // ========= TAB2: ì±—ë´‡ ë°ì´í„° ë§í¬ ê´€ë¦¬ =========
    (function initChatbotLinks(){
      const nameInput = document.getElementById("chatbotLinkName");
      const urlInput = document.getElementById("chatbotLinkUrl");
      const btnAdd = document.getElementById("btnChatbotAddLink");
      const listContainer = document.getElementById("chatbotLinkList");
      const STORAGE_KEY = "ca_chatbot_links";

      function load(){
        listContainer.innerHTML = "";
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          listContainer.innerHTML = '<div class="help-text">ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        let links;
        try{
          links = JSON.parse(raw) || [];
        }catch(e){
          listContainer.innerHTML = '<div class="help-text">ë§í¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          return;
        }
        if(!links.length){
          listContainer.innerHTML = '<div class="help-text">ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        links.forEach((item, idx) => {
          const div = document.createElement("div");
          div.className = "template-item";
          const title = document.createElement("div");
          title.className = "template-title";
          const left = document.createElement("div");
          left.textContent = item.name || "(ì´ë¦„ ì—†ìŒ)";
          const right = document.createElement("div");
          const openBtn = document.createElement("button");
          openBtn.className = "btn btn-primary btn-sm";
          openBtn.type = "button";
          openBtn.textContent = "ì—´ê¸°";
          openBtn.addEventListener("click", () => {
            if(item.url) window.open(item.url,"_blank");
          });
          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-ghost btn-sm";
          delBtn.type = "button";
          delBtn.textContent = "ì‚­ì œ";
          delBtn.addEventListener("click", () => {
            links.splice(idx,1);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
            load();
          });
          right.appendChild(openBtn);
          right.appendChild(delBtn);
          title.appendChild(left);
          title.appendChild(right);

          const meta = document.createElement("div");
          meta.className = "template-meta";
          meta.textContent = item.url || "";

          div.appendChild(title);
          div.appendChild(meta);
          listContainer.appendChild(div);
        });
      }

      btnAdd.addEventListener("click", () => {
        const name = nameInput.value.trim();
        const url = urlInput.value.trim();
        if(!name || !url){
          alert("ì´ë¦„ê³¼ URLì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        let links = [];
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          try{links = JSON.parse(raw) || [];}catch(e){}
        }
        links.push({
          name,
          url,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(links));
        nameInput.value = "";
        urlInput.value = "";
        load();
      });

      load();
    })();

    // ========= TAB3: ì„¸ì¼ì¦ˆ ë©˜íŠ¸ GPTs =========
    (function initSalesGPT(){
      const apiKeyInput = document.getElementById("openaiApiKey");
      const btnToggleKey = document.getElementById("btnToggleApiKey");
      const systemPromptInput = document.getElementById("salesSystemPrompt");
      const userPromptInput = document.getElementById("salesUserPrompt");
      const btnGenerate = document.getElementById("btnGenerateSales");
      const statusText = document.getElementById("salesStatusText");
      const resultArea = document.getElementById("salesResult");
      const templateTitleInput = document.getElementById("salesTemplateTitle");
      const btnSaveTemplate = document.getElementById("btnSaveSalesTemplate");
      const templateList = document.getElementById("salesTemplateList");
      const STORAGE_KEY = "ca_sales_templates";

      btnToggleKey.addEventListener("click", () => {
        const type = apiKeyInput.getAttribute("type");
        apiKeyInput.setAttribute("type", type === "password" ? "text" : "password");
        btnToggleKey.textContent = type === "password" ? "ìˆ¨ê¸°ê¸°" : "ë³´ê¸°";
      });

      async function callOpenAI(apiKey, systemPrompt, userPrompt){
        const endpoint = "https://api.openai.com/v1/chat/completions";
        const body = {
          model: "gpt-4.1-mini",
          messages:[
            { role:"system", content: systemPrompt || "You are a helpful assistant." },
            { role:"user", content: userPrompt }
          ],
          temperature:0.7
        };
        const res = await fetch(endpoint, {
          method:"POST",
          headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer " + apiKey
          },
          body:JSON.stringify(body)
        });
        if(!res.ok){
          const text = await res.text();
          throw new Error("API ì˜¤ë¥˜: " + text);
        }
        const data = await res.json();
        const content = data.choices?.[0]?.message?.content || "";
        return content;
      }

      btnGenerate.addEventListener("click", async () => {
        const key = apiKeyInput.value.trim();
        const sys = systemPromptInput.value.trim();
        const usr = userPromptInput.value.trim();
        if(!key){
          alert("OpenAI API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        if(!usr){
          alert("ìš”ì²­ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        statusText.textContent = "ìƒì„± ì¤‘...";
        statusText.style.color = "#e5e7eb";
        btnGenerate.disabled = true;
        btnGenerate.textContent = "ìƒì„± ì¤‘...";
        resultArea.value = "";
        try{
          const content = await callOpenAI(key, sys, usr);
          resultArea.value = content;
          statusText.textContent = "ì™„ë£Œ";
          statusText.style.color = "#22c55e";
        }catch(e){
          console.error(e);
          statusText.textContent = "ì˜¤ë¥˜ ë°œìƒ: " + e.message;
          statusText.style.color = "#ef4444";
        }finally{
          btnGenerate.disabled = false;
          btnGenerate.textContent = "ğŸ§  ì„¸ì¼ì¦ˆ ë©˜íŠ¸ ìƒì„±";
        }
      });

      function loadTemplates(){
        templateList.innerHTML = "";
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          templateList.innerHTML = '<div class="help-text">ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        let list;
        try{
          list = JSON.parse(raw) || [];
        }catch(e){
          templateList.innerHTML = '<div class="help-text">í…œí”Œë¦¿ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          return;
        }
        if(!list.length){
          templateList.innerHTML = '<div class="help-text">ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        list.forEach((item, idx) => {
          const div = document.createElement("div");
          div.className = "template-item";

          const title = document.createElement("div");
          title.className = "template-title";
          const left = document.createElement("div");
          left.textContent = item.title || "(ì œëª© ì—†ìŒ)";
          const right = document.createElement("div");
          const copyBtn = document.createElement("button");
          copyBtn.className = "btn btn-primary btn-sm";
          copyBtn.type = "button";
          copyBtn.textContent = "ë³µì‚¬";
          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(item.content || "").then(() => {
              alert("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }).catch(() => alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."));
          });
          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-ghost btn-sm";
          delBtn.type = "button";
          delBtn.textContent = "ì‚­ì œ";
          delBtn.addEventListener("click", () => {
            list.splice(idx,1);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            loadTemplates();
          });
          right.appendChild(copyBtn);
          right.appendChild(delBtn);
          title.appendChild(left);
          title.appendChild(right);

          const meta = document.createElement("div");
          meta.className = "template-meta";
          const date = item.createdAt ? new Date(item.createdAt) : null;
          meta.textContent = date ? "ì €ì¥: " + date.toLocaleString() : "";

          const body = document.createElement("div");
          body.className = "template-body";
          body.textContent = item.content || "";

          div.appendChild(title);
          div.appendChild(meta);
          div.appendChild(body);
          templateList.appendChild(div);
        });
      }

      btnSaveTemplate.addEventListener("click", () => {
        const title = templateTitleInput.value.trim();
        const content = resultArea.value.trim();
        if(!title){
          alert("í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        if(!content){
          alert("ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }
        let list = [];
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          try{list = JSON.parse(raw) || [];}catch(e){}
        }
        list.unshift({
          title,
          content,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        templateTitleInput.value = "";
        loadTemplates();
      });

      loadTemplates();
    })();

    // ========= TAB4: ë“œë¼ì´ë¸Œ í´ë” ë§í¬ =========
    (function initDriveFolders(){
      const nameInput = document.getElementById("driveFolderName");
      const urlInput = document.getElementById("driveFolderUrl");
      const btnAdd = document.getElementById("btnAddDriveFolder");
      const btnClear = document.getElementById("btnClearDriveFolders");
      const grid = document.getElementById("driveFolderGrid");
      const STORAGE_KEY = "ca_drive_folders";

      function load(){
        grid.innerHTML = "";
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          grid.innerHTML = '<div class="help-text">ë“±ë¡ëœ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        let list;
        try{
          list = JSON.parse(raw) || [];
        }catch(e){
          grid.innerHTML = '<div class="help-text">í´ë” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
          return;
        }
        if(!list.length){
          grid.innerHTML = '<div class="help-text">ë“±ë¡ëœ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }
        list.forEach((item, idx) => {
          const card = document.createElement("div");
          card.className = "folder-card";
          card.addEventListener("click", (e) => {
            // ì‚­ì œ ë²„íŠ¼ í´ë¦­ì€ ë§í¬ ì´ë™ ë§‰ê¸°
            if(e.target.closest(".folder-delete")) return;
            if(item.url) window.open(item.url,"_blank");
          });

          const name = document.createElement("div");
          name.className = "folder-name";
          const icon = document.createElement("span");
          icon.className = "icon";
          icon.textContent = "ğŸ“";
          const text = document.createElement("span");
          text.textContent = item.name || "(ì´ë¦„ ì—†ìŒ)";
          name.appendChild(icon);
          name.appendChild(text);

          const url = document.createElement("div");
          url.className = "folder-url";
          url.textContent = item.url || "";

          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-ghost btn-sm folder-delete";
          delBtn.type = "button";
          delBtn.textContent = "Ã—";
          delBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            list.splice(idx,1);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            load();
          });

          card.appendChild(name);
          card.appendChild(url);
          card.appendChild(delBtn);
          grid.appendChild(card);
        });
      }

      btnAdd.addEventListener("click", () => {
        const name = nameInput.value.trim();
        const url = urlInput.value.trim();
        if(!name || !url){
          alert("í´ë” ì´ë¦„ê³¼ ë§í¬ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        let list = [];
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          try{list = JSON.parse(raw) || [];}catch(e){}
        }
        list.push({
          name,
          url,
          createdAt: new Date().toISOString()
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        nameInput.value = "";
        urlInput.value = "";
        load();
      });

      btnClear.addEventListener("click", () => {
        if(!confirm("ë“±ë¡ëœ ëª¨ë“  í´ë” ë§í¬ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;
        localStorage.removeItem(STORAGE_KEY);
        load();
      });

      load();
    })();

    // ========= TAB5: ê²°ì œì CSV ì •ë¦¬ =========
    (function initCsv(){
      const fileInput = document.getElementById("csvFileInput");
      const webAppInput = document.getElementById("csvWebAppUrl");
      const btnDownload = document.getElementById("btnDownloadCsvClean");
      const btnSend = document.getElementById("btnSendCsvToWebApp");
      const statusText = document.getElementById("csvStatusText");
      const previewContainer = document.getElementById("csvPreviewContainer");
      const previewTable = document.getElementById("csvPreviewTable");

      let parsedCsv = null; // { headers: [], rows: [][] }

      function parseCsv(text){
        const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
        if(!lines.length) return { headers: [], rows: [] };
        const rows = lines.map(line => {
          // ì•„ì£¼ ë‹¨ìˆœí•œ CSV íŒŒì„œ (ì½¤ë§ˆ ê¸°ì¤€ ë¶„ë¦¬, í°ë”°ì˜´í‘œ ì²˜ë¦¬ X)
          return line.split(",").map(v => v.trim());
        });
        const headers = rows[0];
        const dataRows = rows.slice(1);
        return { headers, rows:dataRows };
      }

      function renderPreview(data){
        const { headers, rows } = data;
        previewTable.innerHTML = "";
        if(!headers.length){
          previewContainer.style.display = "none";
          return;
        }
        const thead = document.createElement("thead");
        const trHead = document.createElement("tr");
        headers.forEach(h => {
          const th = document.createElement("th");
          th.textContent = h;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);
        previewTable.appendChild(thead);

        const tbody = document.createElement("tbody");
        rows.forEach(row => {
          const tr = document.createElement("tr");
          headers.forEach((_, idx) => {
            const td = document.createElement("td");
            td.textContent = row[idx] || "";
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        previewTable.appendChild(tbody);
        previewContainer.style.display = "block";
      }

      fileInput.addEventListener("change", () => {
        const file = fileInput.files?.[0];
        if(!file){
          statusText.textContent = "CSV ë¯¸ë¡œë”©";
          parsedCsv = null;
          previewContainer.style.display = "none";
          return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
          try{
            const text = e.target.result;
            const data = parseCsv(text);
            parsedCsv = data;
            renderPreview(data);
            statusText.textContent = `ë¶ˆëŸ¬ì˜´: ${file.name} (í–‰ ${data.rows.length}ê°œ)`;
          }catch(err){
            console.error(err);
            statusText.textContent = "CSV íŒŒì‹± ì˜¤ë¥˜";
            parsedCsv = null;
            previewContainer.style.display = "none";
          }
        };
        reader.readAsText(file, "utf-8");
      });

      btnDownload.addEventListener("click", () => {
        if(!parsedCsv){
          alert("ë¨¼ì € CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
          return;
        }
        const { headers, rows } = parsedCsv;
        const lines = [];
        lines.push(headers.join(","));
        rows.forEach(row => {
          const line = headers.map((_, idx) => row[idx] || "");
          lines.push(line.join(","));
        });
        const blob = new Blob([lines.join("\n")], { type:"text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "cleaned.csv";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });

      btnSend.addEventListener("click", async () => {
        if(!parsedCsv){
          alert("ë¨¼ì € CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
          return;
        }
        const url = webAppInput.value.trim();
        if(!url){
          alert("Apps Script WebApp URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }
        statusText.textContent = "WebAppìœ¼ë¡œ ì „ì†¡ ì¤‘...";
        statusText.style.color = "#e5e7eb";
        try{
          const payload = {
            headers: parsedCsv.headers,
            rows: parsedCsv.rows
          };
          const res = await fetch(url, {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify(payload)
          });
          if(!res.ok){
            const text = await res.text();
            throw new Error(text);
          }
          const data = await res.text();
          statusText.textContent = "ì „ì†¡ ì™„ë£Œ: " + data;
          statusText.style.color = "#22c55e";
        }catch(e){
          console.error(e);
          statusText.textContent = "ì „ì†¡ ì‹¤íŒ¨: " + e.message;
          statusText.style.color = "#ef4444";
        }
      });
    })();
  </script>
</body>
</html>
